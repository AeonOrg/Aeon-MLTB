{% extends "base.html" %}

{% block title %}Import Configuration - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Import Configuration</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <form id="importConfigForm" enctype="multipart/form-data">
                                <div class="form-group">
                                    <label for="configFile">Configuration File</label>
                                    <input type="file" class="form-control-file" id="configFile" name="config_file" 
                                           accept=".json" required>
                                    <small class="form-text text-muted">
                                        Select a JSON configuration file exported from this system
                                    </small>
                                </div>
                                
                                <div class="form-group">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="overwriteExisting" 
                                               name="overwrite_existing" checked>
                                        <label class="form-check-label" for="overwriteExisting">
                                            Overwrite existing settings
                                        </label>
                                        <small class="form-text text-muted">
                                            If unchecked, only new settings will be imported
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="createBackup" 
                                               name="create_backup" checked>
                                        <label class="form-check-label" for="createBackup">
                                            Create backup before import
                                        </label>
                                        <small class="form-text text-muted">
                                            Recommended: Create a backup of current settings
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <button type="button" class="btn btn-primary" onclick="importConfig()">
                                        Import Configuration
                                    </button>
                                    <a href="/admin/settings" class="btn btn-secondary">Cancel</a>
                                </div>
                            </form>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Import Instructions</h5>
                                </div>
                                <div class="card-body">
                                    <ol>
                                        <li>Select a valid JSON configuration file</li>
                                        <li>Choose whether to overwrite existing settings</li>
                                        <li>Optionally create a backup (recommended)</li>
                                        <li>Click "Import Configuration"</li>
                                    </ol>
                                    
                                    <div class="alert alert-warning mt-3">
                                        <strong>Warning:</strong> Importing configuration will modify your current settings. 
                                        Make sure you have a backup before proceeding.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5 class="card-title">Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <a href="/admin/config/export" class="btn btn-success btn-block">
                                        Export Current Config
                                    </a>
                                    <button type="button" class="btn btn-warning btn-block" onclick="resetToDefaults()">
                                        Reset to Defaults
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Configuration File Format</h3>
                </div>
                <div class="card-body">
                    <p>The configuration file should be a JSON file with the following structure:</p>
                    <pre><code>{
  "site_settings": {
    "site_name": "StreamBot",
    "site_description": "Media Streaming Platform"
  },
  "ui_settings": {
    "theme": "dark",
    "items_per_page": 10
  },
  "security_settings": {
    "require_login": true,
    "session_timeout": 24
  },
  "streaming_settings": {
    "chunk_size": 512,
    "enable_range_requests": true
  },
  "export_timestamp": 1640995200,
  "export_version": "1.0"
}</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function importConfig() {
    const form = document.getElementById('importConfigForm');
    const formData = new FormData(form);
    
    if (!formData.get('config_file').name) {
        alert('Please select a configuration file');
        return;
    }
    
    if (confirm('Are you sure you want to import this configuration? This will modify your current settings.')) {
        fetch('/admin/config/import', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Configuration imported successfully!');
                window.location.href = '/admin/settings';
            } else {
                alert('Error importing configuration: ' + data.error);
            }
        })
        .catch(error => {
            alert('Error importing configuration: ' + error.message);
        });
    }
}

function resetToDefaults() {
    if (confirm('Are you sure you want to reset all settings to defaults? This action cannot be undone.')) {
        fetch('/admin/config/reset', {method: 'POST'})
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Configuration reset to defaults successfully!');
                window.location.href = '/admin/settings';
            } else {
                alert('Error resetting configuration: ' + data.error);
            }
        });
    }
}
</script>
{% endblock %}
