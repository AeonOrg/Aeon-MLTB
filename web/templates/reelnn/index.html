{% extends "reelnn/base.html" %}

{% block title %}{{ site_name or "reelnn" }} - Home{% endblock %}

{% block content %}
<!-- Hero Slideshow - Exact Reelnn Implementation -->
<section class="relative h-screen overflow-hidden">
    {% if featured_media %}
        {% for media in featured_media[:5] %}
        <div class="absolute inset-0 w-full h-full {% if not loop.first %}opacity-0{% endif %} transition-opacity duration-1000" data-slide="{{ loop.index0 }}">
            <div class="absolute z-[2] w-full h-full bg-background/30 bg-gradient-to-b from-background/10 to-background"></div>
            {% if media.backdrop_url %}
                <img src="{{ media.backdrop_url }}" alt="{{ media.enhanced_title or media.file_name }}" class="w-full h-full object-cover object-center" loading="{% if loop.first %}eager{% else %}lazy{% endif %}">
            {% else %}
                <div class="w-full h-full bg-gray-800 flex items-center justify-center">
                    <div class="text-center text-gray-400">
                        <div class="text-6xl mb-4">🎬</div>
                        <p class="text-xl">No backdrop available</p>
                    </div>
                </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div class="reelnn-hero-slide active">
            <div class="reelnn-hero-overlay"></div>
            <div class="w-full h-full bg-gray-800 flex items-center justify-center">
                <div class="text-center text-gray-400">
                    <div class="text-6xl mb-4">🎬</div>
                    <p class="text-xl">Welcome to {{ site_name or "reelnn" }}</p>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Hero Content Overlay - Exact Reelnn Implementation -->
    <div class="relative z-20 h-full flex flex-col justify-end px-4 sm:px-8 md:px-12 lg:px-16 pb-24 sm:pb-12 md:pb-16 pt-16 sm:pt-20 md:pt-24">
        {% if featured_media and featured_media[0] %}
            {% set current_media = featured_media[0] %}
            <div class="w-full mx-auto md:mx-4 lg:mx-8 xl:mx-16 max-w-full sm:max-w-xl md:max-w-2xl lg:max-w-4xl">
                <div class="flex items-center gap-2 sm:gap-4 mb-2 sm:mb-4">
                    {% if current_media.tmdb_data and current_media.tmdb_data.logo %}
                        <img src="https://image.tmdb.org/t/p/w500{{ current_media.tmdb_data.logo }}" alt="{{ current_media.enhanced_title or current_media.file_name }} Logo" class="object-contain w-48 sm:w-64 md:w-80 lg:w-96 h-auto">
                    {% else %}
                        <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-white leading-tight">
                            {% set display_title = current_media.enhanced_title or current_media.file_name %}
                            {% if display_title.endswith('.mkv') or display_title.endswith('.mp4') or display_title.endswith('.avi') %}
                                {% set clean_title = display_title.rsplit('.', 1)[0] %}
                                {% set clean_title = clean_title.replace('_', ' ').replace('.', ' ') %}
                                {{ clean_title }}
                            {% else %}
                                {{ display_title }}
                            {% endif %}
                        </h1>
                    {% endif %}
                </div>

                <!-- Movie Info -->
                <div class="flex flex-wrap items-center gap-2 sm:gap-4 mb-4 sm:mb-6 text-xs sm:text-sm text-gray-300">
                    {% if current_media.tmdb_data and current_media.tmdb_data.release_date %}
                        <span>{{ current_media.tmdb_data.release_date[:4] }}</span>
                    {% endif %}
                    {% if current_media.tmdb_data and current_media.tmdb_data.runtime %}
                        <span>{{ current_media.tmdb_data.runtime }}m</span>
                    {% endif %}
                    {% if current_media.quality %}
                        <span class="bg-gray-700 px-2 py-1 rounded">{{ current_media.quality }}</span>
                    {% endif %}
                    {% if current_media.tmdb_data and current_media.tmdb_data.vote_average %}
                        <div class="flex items-center gap-1">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                            <span>{{ "%.1f"|format(current_media.tmdb_data.vote_average) }}</span>
                        </div>
                    {% endif %}
                </div>

                <!-- Overview -->
                {% if current_media.tmdb_data and current_media.tmdb_data.overview %}
                    <p class="text-sm sm:text-base md:text-lg text-gray-300 mb-6 sm:mb-8 leading-relaxed line-clamp-3 max-w-2xl">
                        {{ current_media.tmdb_data.overview }}
                    </p>
                {% endif %}

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3 sm:gap-4">
                    <a href="{% if current_media.media_type == 'tv' or current_media.media_type == 'show' %}/show/{{ current_media.hash_id }}{% else %}/movie/{{ current_media.hash_id }}{% endif %}" class="inline-flex items-center gap-2 bg-white text-black px-4 sm:px-6 md:px-8 py-2 sm:py-3 rounded-lg font-semibold hover:bg-gray-200 transition-all duration-300 text-sm sm:text-base">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                        </svg>
                        Play
                    </a>
                    <a href="/{{ current_media.media_type or 'movie' }}/{{ current_media.hash_id }}" class="inline-flex items-center gap-2 border border-gray-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-semibold hover:bg-gray-800 transition-all duration-300 text-sm sm:text-base">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        More Info
                    </a>
                </div>
            </div>
        {% else %}
            <div class="w-full mx-auto md:mx-4 lg:mx-8 xl:mx-16 max-w-full sm:max-w-xl md:max-w-2xl lg:max-w-4xl">
                <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-white leading-tight mb-4">
                    Welcome to {{ site_name or "reelnn" }}
                </h1>
                <p class="text-sm sm:text-base md:text-lg text-gray-300 mb-6 sm:mb-8 leading-relaxed max-w-2xl">
                    Your personal streaming platform
                </p>
            </div>
        {% endif %}
    </div>

    <!-- Slide Indicators -->
    {% if featured_media and featured_media|length > 1 %}
    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30 flex space-x-2">
        {% for media in featured_media[:5] %}
        <button class="w-2 h-2 rounded-full transition-all duration-300 {% if loop.first %}bg-white w-6{% else %}bg-white/50{% endif %}" data-slide="{{ loop.index0 }}" aria-label="Go to slide {{ loop.index }}"></button>
        {% endfor %}
    </div>
    {% endif %}
</section>

<!-- Trending Section - Exact Reelnn Implementation -->
{% if trending_media %}
<div class="font-mont w-full px-2 sm:px-4 md:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <div class="flex flex-col">
            <span class="text-xs font-semibold text-red-500 uppercase tracking-wider mb-1">TRENDING</span>
            <h2 class="text-2xl sm:text-3xl font-bold text-white">NOW</h2>
        </div>
        <a href="/browse/trending" class="flex items-center gap-1 text-white hover:text-red-400 transition-colors text-sm font-medium">
            <span>See More</span>
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"/>
            </svg>
        </a>
    </div>
    <div class="relative">
        <div class="flex overflow-x-auto pb-4 gap-3 sm:gap-4 md:gap-5 lg:gap-6 scrollbar-hide" style="scrollbar-width: none; -ms-overflow-style: none;">
            {% for media in trending_media %}
            <div class="flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] lg:w-[200px]">
                <a href="/{{ media.media_type or 'movie' }}/{{ media.hash_id }}" class="block">
                    <div class="relative group cursor-pointer">
                        <div class="aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 transition-transform duration-300 group-hover:scale-105">
                            {% if media.thumbnail %}
                                <img src="{{ media.thumbnail }}" alt="{{ media.enhanced_title or media.file_name }}" class="w-full h-full object-cover" loading="lazy">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center text-4xl text-gray-600">
                                    {% if media.is_video %}🎬{% else %}🎵{% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="mt-2">
                            <h3 class="text-sm font-semibold text-white line-clamp-2 leading-tight" title="{{ media.enhanced_title or media.file_name }}">
                                {% set display_title = media.enhanced_title or media.file_name %}
                                {% if display_title.endswith('.mkv') or display_title.endswith('.mp4') or display_title.endswith('.avi') %}
                                    {% set clean_title = display_title.rsplit('.', 1)[0] %}
                                    {% set clean_title = clean_title.replace('_', ' ').replace('.', ' ') %}
                                    {{ clean_title }}
                                {% else %}
                                    {{ display_title }}
                                {% endif %}
                            </h3>
                            <div class="flex gap-2 text-xs text-gray-400 mt-1">
                                {% if media.tmdb_data and media.tmdb_data.release_date %}
                                    <span>{{ media.tmdb_data.release_date[:4] }}</span>
                                {% endif %}
                                {% if media.quality %}
                                    <span>{{ media.quality }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Additions - Exact Reelnn Implementation -->
{% if recent_media %}
<div class="font-mont w-full px-2 sm:px-4 md:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <div class="flex flex-col">
            <span class="text-xs font-semibold text-red-500 uppercase tracking-wider mb-1">RECENTLY</span>
            <h2 class="text-2xl sm:text-3xl font-bold text-white">ADDED</h2>
        </div>
        <a href="/browse/recent" class="flex items-center gap-1 text-white hover:text-red-400 transition-colors text-sm font-medium">
            <span>See More</span>
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"/>
            </svg>
        </a>
    </div>
    <div class="relative">
        <div class="flex overflow-x-auto pb-4 gap-3 sm:gap-4 md:gap-5 lg:gap-6 scrollbar-hide" style="scrollbar-width: none; -ms-overflow-style: none;">
            {% for media in recent_media %}
            <div class="flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] lg:w-[200px]">
                <a href="/{{ media.media_type or 'movie' }}/{{ media.hash_id }}" class="block">
                    <div class="relative group cursor-pointer">
                        <div class="aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 transition-transform duration-300 group-hover:scale-105">
                            {% if media.poster_path or (media.tmdb_data and media.tmdb_data.poster_path) %}
                                <img src="{{ get_media_poster_url(media) }}" alt="{{ media.enhanced_title or media.file_name }}" class="w-full h-full object-cover" loading="lazy">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center text-4xl text-gray-600">
                                    {% if media.is_video %}🎬{% else %}🎵{% endif %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="mt-2">
                            <h3 class="text-sm font-semibold text-white line-clamp-2 leading-tight" title="{{ media.enhanced_title or media.file_name }}">
                                {% set display_title = media.enhanced_title or media.file_name %}
                                {% if display_title.endswith('.mkv') or display_title.endswith('.mp4') or display_title.endswith('.avi') %}
                                    {% set clean_title = display_title.rsplit('.', 1)[0] %}
                                    {% set clean_title = clean_title.replace('_', ' ').replace('.', ' ') %}
                                    {{ clean_title }}
                                {% else %}
                                    {{ display_title }}
                                {% endif %}
                            </h3>
                            <div class="flex gap-2 text-xs text-gray-400 mt-1">
                                {% if media.tmdb_data and media.tmdb_data.release_date %}
                                    <span>{{ media.tmdb_data.release_date[:4] }}</span>
                                {% endif %}
                                {% if media.quality %}
                                    <span>{{ media.quality }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Latest Movies - Exact Reelnn Implementation -->
<div class="font-mont w-full px-2 sm:px-4 md:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <div class="flex flex-col">
            <span class="text-xs font-semibold text-red-500 uppercase tracking-wider mb-1">LATEST</span>
            <h2 class="text-2xl sm:text-3xl font-bold text-white">MOVIES</h2>
        </div>
        <a href="/browse/movie" class="flex items-center gap-1 text-white hover:text-red-400 transition-colors text-sm font-medium">
            <span>See More</span>
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"/>
            </svg>
        </a>
    </div>
    <div class="relative">
        <div class="flex overflow-x-auto pb-4 gap-3 sm:gap-4 md:gap-5 lg:gap-6 scrollbar-hide" style="scrollbar-width: none; -ms-overflow-style: none;">
            {% for media in recent_media[:20] %}
                {% if media.is_video and (not media.series_data or media.media_type == 'movie') %}
                <div class="flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] lg:w-[200px]">
                    <a href="/movie/{{ media.hash_id }}" class="block">
                        <div class="relative group cursor-pointer">
                            <div class="aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 transition-transform duration-300 group-hover:scale-105">
                                {% if media.poster_path or (media.tmdb_data and media.tmdb_data.poster_path) %}
                                    <img src="{{ get_media_poster_url(media) }}" alt="{{ media.enhanced_title or media.file_name }}" class="w-full h-full object-cover" loading="lazy">
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center text-4xl text-gray-600">🎬</div>
                                {% endif %}
                            </div>
                            <div class="mt-2">
                                <h3 class="text-sm font-semibold text-white line-clamp-2 leading-tight" title="{{ media.enhanced_title or media.file_name }}">
                                    {% set display_title = media.enhanced_title or media.file_name %}
                                    {% if display_title.endswith('.mkv') or display_title.endswith('.mp4') or display_title.endswith('.avi') %}
                                        {% set clean_title = display_title.rsplit('.', 1)[0] %}
                                        {% set clean_title = clean_title.replace('_', ' ').replace('.', ' ') %}
                                        {{ clean_title }}
                                    {% else %}
                                        {{ display_title }}
                                    {% endif %}
                                </h3>
                                <div class="flex gap-2 text-xs text-gray-400 mt-1">
                                    {% if media.tmdb_data and media.tmdb_data.release_date %}
                                        <span>{{ media.tmdb_data.release_date[:4] }}</span>
                                    {% endif %}
                                    {% if media.quality %}
                                        <span>{{ media.quality }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- Latest Series - Exact Reelnn Implementation -->
<div class="font-mont w-full px-2 sm:px-4 md:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <div class="flex flex-col">
            <span class="text-xs font-semibold text-red-500 uppercase tracking-wider mb-1">LATEST</span>
            <h2 class="text-2xl sm:text-3xl font-bold text-white">SERIES</h2>
        </div>
        <a href="/browse/show" class="flex items-center gap-1 text-white hover:text-red-400 transition-colors text-sm font-medium">
            <span>See More</span>
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"/>
            </svg>
        </a>
    </div>
    <div class="relative">
        <div class="flex overflow-x-auto pb-4 gap-3 sm:gap-4 md:gap-5 lg:gap-6 scrollbar-hide" style="scrollbar-width: none; -ms-overflow-style: none;">
            {% for media in recent_media[:20] %}
                {% if media.is_video and (media.series_data or media.media_type == 'tv') %}
                <div class="flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] lg:w-[200px]">
                    <a href="/show/{{ media.hash_id }}" class="block">
                        <div class="relative group cursor-pointer">
                            <div class="aspect-[2/3] rounded-lg overflow-hidden bg-gray-800 transition-transform duration-300 group-hover:scale-105">
                                {% if media.thumbnail %}
                                    <img src="{{ media.thumbnail }}" alt="{{ media.enhanced_title or media.file_name }}" class="w-full h-full object-cover" loading="lazy">
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center text-4xl text-gray-600">📺</div>
                                {% endif %}
                            </div>
                            <div class="mt-2">
                                <h3 class="text-sm font-semibold text-white line-clamp-2 leading-tight" title="{{ media.enhanced_title or media.file_name }}">
                                    {% set display_title = media.enhanced_title or media.file_name %}
                                    {% if display_title.endswith('.mkv') or display_title.endswith('.mp4') or display_title.endswith('.avi') %}
                                        {% set clean_title = display_title.rsplit('.', 1)[0] %}
                                        {% set clean_title = clean_title.replace('_', ' ').replace('.', ' ') %}
                                        {{ clean_title }}
                                    {% else %}
                                        {{ display_title }}
                                    {% endif %}
                                </h3>
                                <div class="flex gap-2 text-xs text-gray-400 mt-1">
                                    {% if media.tmdb_data and media.tmdb_data.first_air_date %}
                                        <span>{{ media.tmdb_data.first_air_date[:4] }}</span>
                                    {% endif %}
                                    {% if media.quality %}
                                        <span>{{ media.quality }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Hero Slideshow
document.addEventListener('DOMContentLoaded', function() {
    const slides = document.querySelectorAll('[data-slide]');
    const indicators = document.querySelectorAll('button[data-slide]');
    let currentSlide = 0;

    if (slides.length > 1) {
        // Auto-advance slides
        const slideInterval = setInterval(() => {
            // Remove active class from current slide
            slides[currentSlide].classList.remove('opacity-100');
            slides[currentSlide].classList.add('opacity-0');
            indicators[currentSlide]?.classList.remove('bg-white', 'w-6');
            indicators[currentSlide]?.classList.add('bg-white/50', 'w-2');

            // Move to next slide
            currentSlide = (currentSlide + 1) % slides.length;

            // Add active class to new slide
            slides[currentSlide].classList.remove('opacity-0');
            slides[currentSlide].classList.add('opacity-100');
            indicators[currentSlide]?.classList.remove('bg-white/50', 'w-2');
            indicators[currentSlide]?.classList.add('bg-white', 'w-6');
        }, 8000);

        // Manual slide control
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                // Clear auto-advance
                clearInterval(slideInterval);

                // Remove active class from current slide
                slides[currentSlide].classList.remove('opacity-100');
                slides[currentSlide].classList.add('opacity-0');
                indicators[currentSlide].classList.remove('bg-white', 'w-6');
                indicators[currentSlide].classList.add('bg-white/50', 'w-2');

                // Set new slide
                currentSlide = index;

                // Add active class to new slide
                slides[currentSlide].classList.remove('opacity-0');
                slides[currentSlide].classList.add('opacity-100');
                indicators[currentSlide].classList.remove('bg-white/50', 'w-2');
                indicators[currentSlide].classList.add('bg-white', 'w-6');
            });
        });
    }

    // Smooth scrolling for horizontal card grids
    const cardGrids = document.querySelectorAll('.scrollbar-hide');
    cardGrids.forEach(grid => {
        let isDown = false;
        let startX;
        let scrollLeft;

        grid.addEventListener('mousedown', (e) => {
            isDown = true;
            grid.style.cursor = 'grabbing';
            startX = e.pageX - grid.offsetLeft;
            scrollLeft = grid.scrollLeft;
        });

        grid.addEventListener('mouseleave', () => {
            isDown = false;
            grid.style.cursor = 'grab';
        });

        grid.addEventListener('mouseup', () => {
            isDown = false;
            grid.style.cursor = 'grab';
        });

        grid.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - grid.offsetLeft;
            const walk = (x - startX) * 2;
            grid.scrollLeft = scrollLeft - walk;
        });

        // Touch support for mobile
        let startTouchX;
        let startScrollLeft;

        grid.addEventListener('touchstart', (e) => {
            startTouchX = e.touches[0].pageX;
            startScrollLeft = grid.scrollLeft;
        });

        grid.addEventListener('touchmove', (e) => {
            if (!startTouchX) return;
            const touchX = e.touches[0].pageX;
            const walk = (startTouchX - touchX) * 2;
            grid.scrollLeft = startScrollLeft + walk;
        });

        grid.addEventListener('touchend', () => {
            startTouchX = null;
        });
    });

    // Intersection Observer for lazy loading and animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '50px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-fade-in');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    // Observe all sections for animations
    document.querySelectorAll('section').forEach(section => {
        observer.observe(section);
    });

    // Initialize ReelNN-style functionality
    initReelNNHomepage();
});

// ReelNN-style API Integration
async function initReelNNHomepage() {
    try {
        // Load and update content dynamically
        await loadFeaturedContent();
        await loadTrendingContent();
        await loadRecentContent();

        console.log('✅ ReelNN homepage functionality initialized');
    } catch (error) {
        console.error('❌ Error initializing ReelNN homepage:', error);
    }
}

async function loadFeaturedContent() {
    try {
        const response = await fetch('/api/v1/featured?limit=5');
        if (response.ok) {
            const featured = await response.json();
            updateHeroSlider(featured);
        }
    } catch (error) {
        console.error('Error loading featured content:', error);
    }
}

async function loadTrendingContent() {
    try {
        const response = await fetch('/api/v1/trending?limit=10');
        if (response.ok) {
            const trending = await response.json();
            updateTrendingSection(trending);
        }
    } catch (error) {
        console.error('Error loading trending content:', error);
    }
}

async function loadRecentContent() {
    try {
        // Load recent movies
        const moviesResponse = await fetch('/api/v1/recent?media_type=movie&limit=12');
        if (moviesResponse.ok) {
            const recentMovies = await moviesResponse.json();
            updateRecentMoviesSection(recentMovies);
        }

        // Load recent shows
        const showsResponse = await fetch('/api/v1/recent?media_type=tv&limit=12');
        if (showsResponse.ok) {
            const recentShows = await showsResponse.json();
            updateRecentShowsSection(recentShows);
        }
    } catch (error) {
        console.error('Error loading recent content:', error);
    }
}

function updateTrendingSection(trending) {
    // Update trending section with fresh data
    console.log('Updating trending section with', trending.length, 'items');
    // Implementation would update the trending carousel
}

function updateRecentMoviesSection(movies) {
    // Update recent movies section with fresh data
    console.log('Updating recent movies section with', movies.length, 'items');
    // Implementation would update the recent movies carousel
}

function updateRecentShowsSection(shows) {
    // Update recent shows section with fresh data
    console.log('Updating recent shows section with', shows.length, 'items');
    // Implementation would update the recent shows carousel
}

// ReelNN-style navigation functions - exact implementation
function watchContent(id, mediaType) {
    // Use ReelNN URL structure
    const url = mediaType === 'tv' ? `/show/${id}` : `/movie/${id}`;
    window.location.href = url;
}

function showMoreInfo(id, mediaType) {
    // Navigate to detail page for more info - ReelNN style
    watchContent(id, mediaType);
}

// ReelNN-style search functionality
function initSearchFunctionality() {
    const searchInput = document.querySelector('input[name="q"]');
    const searchForm = document.querySelector('form[action="/search"]');

    if (searchInput && searchForm) {
        // Live search suggestions
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();

            if (query.length >= 2) {
                searchTimeout = setTimeout(async () => {
                    await fetchSearchSuggestions(query);
                }, 300);
            } else {
                hideSearchSuggestions();
            }
        });

        // Handle form submission
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `/search?q=${encodeURIComponent(query)}`;
            }
        });
    }
}

async function showSearchSuggestions(query) {
    try {
        const response = await fetch(`/api/v1/search?q=${encodeURIComponent(query)}&limit=5`);
        const data = await response.json();
        const suggestions = data.results || [];

        if (suggestions && suggestions.length > 0) {
            renderSearchSuggestions(suggestions);
        } else {
            hideSearchSuggestions();
        }
    } catch (error) {
        console.error('Error fetching search suggestions:', error);
        hideSearchSuggestions();
    }
}

function renderSearchSuggestions(suggestions) {
    // Create or update suggestions dropdown
    let dropdown = document.getElementById('search-suggestions');
    if (!dropdown) {
        dropdown = document.createElement('div');
        dropdown.id = 'search-suggestions';
        dropdown.className = 'absolute top-full left-0 right-0 bg-gray-900 border border-gray-700 rounded-b-lg shadow-lg z-50 max-h-80 overflow-y-auto';

        const searchContainer = document.querySelector('form[action="/search"]').parentElement;
        searchContainer.style.position = 'relative';
        searchContainer.appendChild(dropdown);
    }

    dropdown.innerHTML = suggestions.map(item => `
        <div class="flex items-center p-3 hover:bg-gray-800 cursor-pointer border-b border-gray-700 last:border-b-0"
             onclick="watchContent('${item.mid || item.sid}', '${item.media_type}')">
            <img src="${item.poster_url || '/static/icons/default-video.svg'}"
                 alt="${item.title}"
                 class="w-12 h-16 object-cover rounded mr-3 flex-shrink-0">
            <div class="flex-1 min-w-0">
                <h4 class="text-white font-medium truncate">${item.title}</h4>
                <p class="text-gray-400 text-sm truncate">${item.overview || 'No description available'}</p>
                <div class="flex items-center gap-2 mt-1">
                    <span class="text-yellow-400 text-xs">★ ${item.vote_average || 'N/A'}</span>
                    <span class="text-gray-500 text-xs">${item.release_date ? item.release_date.substring(0, 4) : item.first_air_date ? item.first_air_date.substring(0, 4) : 'N/A'}</span>
                    <span class="text-blue-400 text-xs">${item.quality || 'HD'}</span>
                </div>
            </div>
        </div>
    `).join('');

    dropdown.style.display = 'block';
}

function hideSearchSuggestions() {
    const dropdown = document.getElementById('search-suggestions');
    if (dropdown) {
        dropdown.style.display = 'none';
    }
}

function updateHeroSlider(featured) {
    try {
        // Update hero slider with featured content
        const heroSection = document.querySelector('.relative.h-screen.overflow-hidden');
        if (heroSection && featured.length > 0) {
            // Update the first slide with featured content
            const firstSlide = heroSection.querySelector('.reelnn-hero-slide');
            if (firstSlide && featured[0]) {
                const media = featured[0];
                const backdropUrl = media.backdrop_url ?
                    `https://image.tmdb.org/t/p/original${media.backdrop_url}` : '';

                if (backdropUrl) {
                    firstSlide.style.backgroundImage = `url(${backdropUrl})`;
                    firstSlide.style.backgroundSize = 'cover';
                    firstSlide.style.backgroundPosition = 'center';
                }
            }
        }
        console.log('✅ Hero slider updated with featured content');
    } catch (error) {
        console.error('Error updating hero slider:', error);
    }
}

// Hide suggestions when clicking outside
document.addEventListener('click', function(e) {
    const searchContainer = document.querySelector('form[action="/search"]')?.parentElement;
    if (searchContainer && !searchContainer.contains(e.target)) {
        hideSearchSuggestions();
    }
});

// Initialize search functionality when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initSearchFunctionality();
});
</script>
{% endblock %}