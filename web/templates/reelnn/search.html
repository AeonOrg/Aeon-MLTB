{% extends "reelnn/base.html" %}

{% block title %}{% if query %}Search: {{ query }}{% else %}Search{% endif %} - {{ site_name or "aimleechbot" }}{% endblock %}

{% block extra_head %}
<style>
    /* Search Hero Section */
    .search-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 4rem 0 2rem;
        color: white;
        margin-bottom: 2rem;
    }
    
    .search-form {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .search-input {
        border-radius: 50px;
        border: none;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        width: 100%;
    }
    
    .search-btn {
        border-radius: 50px;
        padding: 1rem 2rem;
        background: #ff6b6b;
        border: none;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }
    
    .search-btn:hover {
        background: #ff5252;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255,107,107,0.3);
    }
    
    /* Filter Tabs */
    .filter-tabs {
        background: var(--surface-color);
        border-radius: 15px;
        padding: 1rem;
        margin: 2rem 0;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .filter-tab {
        background: transparent;
        border: 2px solid var(--border-color);
        color: var(--text-secondary);
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        margin: 0 0.5rem;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .filter-tab.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }
    
    .filter-tab:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        text-decoration: none;
    }
    
    /* Results Grid */
    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }
    
    .media-card {
        background: var(--surface-color);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
        position: relative;
    }
    
    .media-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        text-decoration: none;
        color: inherit;
    }
    
    .media-poster {
        width: 100%;
        height: 300px;
        object-fit: cover;
        background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
    }
    
    .media-type-badge {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .media-info {
        padding: 1rem;
    }
    
    .media-title {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 0.5rem;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        color: var(--text-primary);
    }
    
    .media-meta {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }
    
    .media-rating {
        background: #ffc107;
        color: #212529;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }
    
    /* No Results */
    .no-results {
        text-align: center;
        padding: 4rem 0;
        color: var(--text-secondary);
    }
    
    .no-results i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    /* Results Info */
    .results-info {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }
    
    /* Pagination */
    .pagination-wrapper {
        margin-top: 3rem;
        text-align: center;
    }
    
    .pagination .page-link {
        border-radius: 10px;
        margin: 0 0.25rem;
        border: none;
        color: var(--primary-color);
        font-weight: 500;
        background: var(--surface-color);
    }
    
    .pagination .page-item.active .page-link {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }
    
    .pagination .page-link:hover {
        background: var(--primary-color);
        color: white;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .search-hero {
            padding: 2rem 0 1rem;
        }
        
        .filter-tabs {
            padding: 0.5rem;
        }
        
        .filter-tab {
            margin: 0.25rem;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .results-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .media-poster {
            height: 225px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Search Hero Section -->
<section class="search-hero">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    {% if query %}
                        Search Results for "{{ query }}"
                    {% else %}
                        Search Movies & TV Shows
                    {% endif %}
                </h1>
                
                <!-- Search Form -->
                <form method="GET" action="/search" class="search-form">
                    <div class="input-group">
                        <input type="text" 
                               name="q" 
                               value="{{ query or '' }}" 
                               class="form-control search-input" 
                               placeholder="Search for movies, TV shows..."
                               required>
                        <button type="submit" class="btn search-btn w-100">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </div>
                    
                    <!-- Hidden fields to preserve filters -->
                    {% if search_type %}
                        <input type="hidden" name="type" value="{{ search_type }}">
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container">
    {% if query %}
        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <a href="/search?q={{ query }}" 
               class="filter-tab {% if not search_type %}active{% endif %}">
                All Results
            </a>
            <a href="/search?q={{ query }}&type=movie" 
               class="filter-tab {% if search_type == 'movie' %}active{% endif %}">
                Movies
            </a>
            <a href="/search?q={{ query }}&type=show" 
               class="filter-tab {% if search_type == 'show' %}active{% endif %}">
                TV Shows
            </a>
        </div>
        
        <!-- Results Info -->
        {% if results %}
            <div class="results-info">
                <i class="fas fa-info-circle me-2"></i>
                Found {{ total_results }} result{{ 's' if total_results != 1 else '' }}
                {% if search_type %}
                    in {{ 'Movies' if search_type == 'movie' else 'TV Shows' }}
                {% endif %}
            </div>
        {% endif %}
        
        <!-- Results Grid -->
        {% if results %}
            <div class="results-grid">
                {% for item in results %}
                    <a href="/{% if item.media_type == 'show' or item.series_data %}show{% else %}watch{% endif %}/{{ item.hash_id }}" 
                       class="media-card">
                        <div class="media-poster">
                            <img src="{{ item.poster_url or '/static/images/default-poster.jpg' }}" 
                                 alt="{{ item.enhanced_title or item.file_name }}"
                                 class="media-poster"
                                 loading="lazy"
                                 onerror="this.src='/static/images/default-poster.jpg'">
                            
                            <div class="media-type-badge">
                                {% if item.series_data %}TV{% else %}Movie{% endif %}
                            </div>
                        </div>
                        
                        <div class="media-info">
                            <div class="media-title">
                                {{ item.enhanced_title or item.file_name }}
                            </div>
                            
                            <div class="media-meta">
                                {% if item.tmdb_data and item.tmdb_data.release_date %}
                                    {{ item.tmdb_data.release_date[:4] }}
                                {% elif item.tmdb_data and item.tmdb_data.first_air_date %}
                                    {{ item.tmdb_data.first_air_date[:4] }}
                                {% endif %}
                                
                                {% if item.series_data %}
                                    • TV Show
                                {% else %}
                                    • Movie
                                {% endif %}
                            </div>
                            
                            {% if item.tmdb_data and item.tmdb_data.vote_average %}
                                <div class="media-rating">
                                    <i class="fas fa-star me-1"></i>
                                    {{ "%.1f"|format(item.tmdb_data.vote_average) }}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <!-- No Results -->
            <div class="no-results">
                <i class="fas fa-search"></i>
                <h3>No results found</h3>
                <p>Try adjusting your search terms or browse our collection.</p>
                <div class="mt-3">
                    <a href="/browse/movie" class="btn btn-primary me-2">Browse Movies</a>
                    <a href="/browse/show" class="btn btn-outline-primary">Browse TV Shows</a>
                </div>
            </div>
        {% endif %}
    {% else %}
        <!-- Search Instructions -->
        <div class="text-center py-5">
            <i class="fas fa-search fa-4x text-muted mb-4"></i>
            <h3>Search our collection</h3>
            <p class="text-muted">Enter a movie or TV show title to get started</p>
        </div>
    {% endif %}
</div>
{% endblock %}
